# Production Event Correlation with OCSF

## ðŸŽ¯ The Real-World Challenge

**Question:** "In production, Sysmon generates thousands of events continuously. How does this software help correlate related events?"

**Answer:** The OCSF Playground is a **transformer code generator**, not a SIEM. It creates the **standardization layer** that enables your SIEM/analytics platform to correlate events effectively.

---

## ðŸ—ï¸ Production Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    30 NATIONAL SECURITY SOCs                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Raw Logs (Windows, Sysmon, Firewall, etc.)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LOG COLLECTION LAYER (Per SOC)                      â”‚
â”‚  â€¢ Winlogbeat / Filebeat / Fluentd / NXLog / Logstash           â”‚
â”‚  â€¢ Collects logs from endpoints, servers, network devices       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         OCSF TRANSFORMATION LAYER â† THIS IS WHERE YOU USE        â”‚
â”‚                  THE PLAYGROUND-GENERATED CODE                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Transformer 1: Windows Event Logs â†’ OCSF v1.7.0      â”‚    â”‚
â”‚  â”‚  (Code generated by OCSF Playground)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Transformer 2: Sysmon Logs â†’ OCSF v1.7.0             â”‚    â”‚
â”‚  â”‚  (Code generated by OCSF Playground)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Transformer 3: Firewall Logs â†’ OCSF v1.7.0           â”‚    â”‚
â”‚  â”‚  (Code generated by OCSF Playground)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  Output: Normalized OCSF JSON events with standard fields       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ OCSF-Compliant JSON Stream
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CENTRALIZED SIEM / DATA LAKE                        â”‚
â”‚  â€¢ Splunk Enterprise Security / Elastic SIEM / QRadar           â”‚
â”‚  â€¢ Snowflake / Databricks / S3 + Athena                         â”‚
â”‚                                                                  â”‚
â”‚  NOW all 30 SOCs use the SAME field names:                      â”‚
â”‚  â€¢ src_endpoint.ip, dst_endpoint.ip                             â”‚
â”‚  â€¢ actor.user.name                                              â”‚
â”‚  â€¢ process.cmd_line                                             â”‚
â”‚  â€¢ file.hash.sha256                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CORRELATION & DETECTION LAYER                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Correlation Rule 1: Detect Attack Chains              â”‚    â”‚
â”‚  â”‚  â€¢ Group events by src_endpoint.ip + time window       â”‚    â”‚
â”‚  â”‚  â€¢ Match: Process Creation â†’ Network Connection â†’ File â”‚    â”‚
â”‚  â”‚  â€¢ Trigger: Alert on Sysmon Event ID 1 + 3 + 11        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Correlation Rule 2: Cross-Zone Threat Hunting         â”‚    â”‚
â”‚  â”‚  â€¢ Query: dst_endpoint.ip = "45.141.215.89"            â”‚    â”‚
â”‚  â”‚  â€¢ Search: ALL 30 SOCs simultaneously                   â”‚    â”‚
â”‚  â”‚  â€¢ Output: List of all compromised systems              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Correlation Rule 3: Lateral Movement Detection        â”‚    â”‚
â”‚  â”‚  â€¢ Track: actor.user.name across multiple devices      â”‚    â”‚
â”‚  â”‚  â€¢ Pattern: Logon (4624) â†’ PsExec (1) â†’ Admin Add      â”‚    â”‚
â”‚  â”‚  â€¢ Timeline: Events within 5-minute window              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SOC ANALYST CONSOLE                             â”‚
â”‚  â€¢ Unified dashboard across all 30 SOCs                         â”‚
â”‚  â€¢ Alerts with full attack chain context                        â”‚
â”‚  â€¢ One query language, standardized field names                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”§ How to Use the Playground for Production Correlation

### **Step 1: Generate Transformers (One-Time Setup)**

For each log source, use the playground to generate transformation code:

**Example: Sysmon Event ID 1 (Process Creation)**

1. Paste one sample Sysmon Event ID 1 log into playground
2. Generate transformer code
3. Deploy to your log pipeline (Logstash, Fluentd, etc.)

**Generated Code:**
```python
def transform_sysmon_event_id_1(raw_log: str) -> dict:
    """
    Transform Sysmon Event ID 1 to OCSF Process Activity (1007)
    Generated by OCSF Playground
    """
    import xml.etree.ElementTree as ET

    root = ET.fromstring(raw_log)
    ns = {'ns': 'http://schemas.microsoft.com/win/2004/08/events/event'}

    # Extract fields
    event_data = {child.get('Name'): child.text
                  for child in root.findall('.//ns:EventData/ns:Data', ns)}
    system = root.find('.//ns:System', ns)

    # Map to OCSF
    ocsf_event = {
        "class_name": "Process Activity",
        "class_uid": 1007,
        "activity_id": 1,  # Launch
        "category_name": "System Activity",
        "category_uid": 1,
        "severity_id": 1,
        "time": system.find('ns:TimeCreated', ns).get('SystemTime'),
        "metadata": {
            "version": "1.7.0",
            "product": {
                "name": "Sysmon",
                "vendor_name": "Microsoft"
            }
        },
        "device": {
            "hostname": system.find('ns:Computer', ns).text,
            "type_id": 1  # Computer
        },
        "process": {
            "pid": int(event_data.get('ProcessId', 0)),
            "file": {
                "path": event_data.get('Image'),
                "name": event_data.get('Image', '').split('\\')[-1]
            },
            "cmd_line": event_data.get('CommandLine'),
            "integrity": event_data.get('IntegrityLevel'),
            "parent_process": {
                "pid": int(event_data.get('ParentProcessId', 0)),
                "file": {
                    "path": event_data.get('ParentImage'),
                    "name": event_data.get('ParentImage', '').split('\\')[-1]
                },
                "cmd_line": event_data.get('ParentCommandLine')
            }
        },
        "actor": {
            "user": {
                "name": event_data.get('User'),
                "uid": event_data.get('LogonGuid')
            }
        },
        # Key correlation fields
        "observables": [
            {
                "name": "process.pid",
                "value": event_data.get('ProcessId'),
                "type_id": 1  # Process ID
            },
            {
                "name": "process.file.hash.sha256",
                "value": event_data.get('Hashes', '').split('SHA256=')[-1].split(',')[0] if 'SHA256=' in event_data.get('Hashes', '') else None,
                "type_id": 7  # File Hash
            }
        ],
        # Custom correlation metadata
        "enrichments": [
            {
                "name": "correlation_id",
                "value": f"{system.find('ns:Computer', ns).text}_{event_data.get('ProcessGuid')}",
                "type": "Process GUID"
            }
        ]
    }

    return ocsf_event
```

### **Step 2: Deploy Transformers to Log Pipeline**

**Example: Logstash Configuration**

```ruby
# /etc/logstash/conf.d/sysmon-ocsf-transform.conf

input {
  beats {
    port => 5044
    type => "sysmon"
  }
}

filter {
  if [type] == "sysmon" {
    # Parse XML
    xml {
      source => "message"
      target => "sysmon_xml"
    }

    # Call Python transformer (via exec or http filter)
    http {
      url => "http://localhost:8000/transform/sysmon"
      verb => "POST"
      body => {
        "log_entry" => "%{message}"
      }
      target_body => "ocsf_event"
    }

    # OR embed Python directly in Logstash Ruby filter
    ruby {
      code => '
        require "python_bridge"
        ocsf = PythonBridge.call_transformer(event.get("message"))
        event.set("ocsf", ocsf)
      '
    }
  }
}

output {
  # Send to Elasticsearch with OCSF schema
  elasticsearch {
    hosts => ["https://siem.defense.mil:9200"]
    index => "ocsf-process-activity-%{+YYYY.MM.dd}"
    document_type => "ocsf"
  }

  # Also send to Splunk
  splunk_hec {
    url => "https://splunk.defense.mil:8088"
    token => "${SPLUNK_HEC_TOKEN}"
    sourcetype => "ocsf:process_activity"
  }
}
```

---

## ðŸ”— Event Correlation Examples

Now that all events are in OCSF format, your SIEM can correlate them:

### **Example 1: Attack Chain Detection (Scenario 2 - APT)**

**Objective:** Detect lateral movement via PsExec

**Events to Correlate:**
1. Sysmon Event ID 3 (Network Connection to C2)
2. Sysmon Event ID 1 (PowerShell with encoded command)
3. Windows Event ID 4624 (Network logon to DC)
4. Sysmon Event ID 1 (PsExec service on DC)

**Splunk SPL Query (OCSF-enabled):**
```spl
index=ocsf sourcetype="ocsf:*"
| eval correlation_key = src_endpoint.ip . "_" . actor.user.name
| transaction correlation_key maxspan=5m
| where
    (match(class_name, "Network Activity") AND dst_endpoint.port=443 AND match(dst_endpoint.hostname, ".*cdn.*"))
    OR (match(class_name, "Process Activity") AND match(process.cmd_line, ".*powershell.*-Encoded.*"))
    OR (match(class_name, "Authentication") AND logon_type=3)
    OR (match(class_name, "Process Activity") AND match(process.file.name, "(?i)psexec"))
| stats
    count,
    values(class_name) as event_types,
    values(dst_endpoint.ip) as c2_ips,
    values(process.cmd_line) as commands,
    values(device.hostname) as affected_hosts
    by correlation_key
| where count >= 3
| eval alert_severity = "CRITICAL - Lateral Movement Detected"
```

**What This Does:**
- Groups events by `src_endpoint.ip` + `actor.user.name` within 5-minute window
- Matches the APT attack pattern (C2 + PowerShell + Network Logon + PsExec)
- Triggers alert if 3+ events match

**Output:**
```
correlation_key: 10.23.45.142_DEFENSE\Administrator
event_types: ["Network Activity", "Process Activity", "Authentication", "Process Activity"]
c2_ips: ["185.220.101.47"]
commands: ["powershell.exe -NoP -NonI -W Hidden...", "C:\Windows\PSEXESVC.exe"]
affected_hosts: ["DOD-WORKSTATION-142", "DOD-SERVER-DC01"]
alert_severity: CRITICAL - Lateral Movement Detected
```

---

### **Example 2: Cross-Zone IOC Hunting (Scenario 6 - Zero-Day)**

**Objective:** Find all systems communicating with C2 IP across all 30 SOCs

**Elastic EQL Query (OCSF-enabled):**
```sql
sequence by src_endpoint.ip with maxspan=1h
  [process where process.file.name == "DefenseTrack.exe"]
  [file where file.name == "msvcr120_compat.dll" and file.path like "C:\\Windows\\Temp\\*"]
  [network where dst_endpoint.ip == "45.141.215.89"]
```

**What This Does:**
- Finds the zero-day attack sequence across ALL 30 SOCs
- Matches: Process â†’ Malicious DLL â†’ C2 Connection
- Returns list of all compromised systems

**Output:**
```json
{
  "matches": [
    {
      "src_endpoint.ip": "10.45.67.12",
      "device.hostname": "PENTAGON-LOGISTICS-12.defense.mil",
      "soc_zone": "Zone 1",
      "first_seen": "2025-12-01T03:12:45Z"
    },
    {
      "src_endpoint.ip": "10.89.12.45",
      "device.hostname": "NAVY-SUPPLY-089.navy.mil",
      "soc_zone": "Zone 15",
      "first_seen": "2025-12-01T04:23:12Z"
    },
    {
      "src_endpoint.ip": "10.123.45.67",
      "device.hostname": "AIRFORCE-BASE-23.af.mil",
      "soc_zone": "Zone 23",
      "first_seen": "2025-12-01T05:45:33Z"
    }
  ],
  "total_compromised": 3,
  "socs_affected": ["Zone 1", "Zone 15", "Zone 23"]
}
```

**Analyst Action:**
> "Zero-day detected in Pentagon (Zone 1). Immediately found 2 more compromised systems in Navy (Zone 15) and Air Force (Zone 23). Isolated all 3 within 10 minutes."

---

### **Example 3: Credential Theft Timeline (Scenario 4 - Mimikatz)**

**Objective:** Reconstruct complete attack timeline

**QRadar AQL Query (OCSF-enabled):**
```sql
SELECT
    time,
    class_name,
    device.hostname,
    process.file.name,
    process.cmd_line,
    actor.user.name,
    observables
FROM ocsf_events
WHERE
    device.hostname = 'FBI-FIELD-OFFICE-23.fbi.gov'
    AND time BETWEEN '2025-12-01 11:30:00' AND '2025-12-01 11:31:00'
    AND (
        process.file.name ILIKE '%mim%'
        OR process.target_process.name = 'lsass.exe'
        OR observables CONTAINS 'SeDebugPrivilege'
        OR file.name = 'credentials.txt'
    )
ORDER BY time ASC
```

**Output (Timeline Reconstruction):**
```
11:30:15.678 - Process Activity - mim.exe launched with LSASS dumping args
11:30:15.890 - Security Finding - SeDebugPrivilege used (Event 4673)
11:30:16.234 - Process Activity - LSASS memory accessed (Sysmon Event 10)
11:30:16.456 - Process Activity - Remote thread in LSASS (Sysmon Event 8)
11:30:18.123 - File Activity - credentials.txt written to disk (Sysmon Event 11)
```

**Analyst Insight:**
> "Complete attack chain reconstructed. From initial execution to credential dump: 2.445 seconds. We can now search for this exact pattern across all 30 SOCs."

---

## ðŸŽ¯ Key Correlation Techniques Enabled by OCSF

### **1. Entity Linking**

**Problem (Without OCSF):**
```
Zone 1: "SourceIP" = 10.1.2.3
Zone 2: "src_ip" = 10.1.2.3
Zone 3: "source_address" = 10.1.2.3
â†’ Can't correlate, different field names
```

**Solution (With OCSF):**
```
All Zones: "src_endpoint.ip" = 10.1.2.3
â†’ One query finds all events from this IP across 30 SOCs
```

### **2. Temporal Correlation**

**OCSF Provides:**
- Standardized `time` field (ISO 8601)
- `time_dt` field (parsed datetime)
- `start_time` / `end_time` for activities

**Enables:**
```python
# Find events within 5-minute attack window
correlation_window = timedelta(minutes=5)
events = query_ocsf_events(
    start_time=initial_event.time,
    end_time=initial_event.time + correlation_window,
    src_endpoint_ip=initial_event.src_endpoint.ip
)
```

### **3. Process Tree Reconstruction**

**OCSF Process Activity Fields:**
- `process.pid` - Current process ID
- `process.parent_process.pid` - Parent process ID
- `process.parent_process.file.path` - Parent executable
- `enrichments.correlation_id` - Process GUID

**Enables:**
```python
# Rebuild full process tree
def build_process_tree(root_pid):
    tree = []
    current_pid = root_pid
    while True:
        process = query_ocsf(f"process.pid = {current_pid}")
        tree.append(process)
        if not process.parent_process.pid:
            break
        current_pid = process.parent_process.pid
    return tree

# Example output:
# explorer.exe (PID 4892)
#   â””â”€ cmd.exe (PID 5624)
#       â””â”€ mim.exe (PID 8756) â† Credential theft!
```

### **4. File Hash Pivoting**

**OCSF File Activity Fields:**
- `file.hash.sha256`
- `file.hash.md5`
- `file.hashes.imphash`

**Enables:**
```sql
-- Find all systems with the same malicious file
SELECT DISTINCT device.hostname, soc_zone
FROM ocsf_events
WHERE file.hash.sha256 = 'A9B8C7D6E5F4A3B2C1D0E9F8A7B6C5D4E3F2A1B0C9D8E7F6A5B4C3D2E1F0A9B8'
```

### **5. User Behavior Analytics**

**OCSF Actor Fields:**
- `actor.user.name`
- `actor.user.uid`
- `actor.user.account_type`

**Enables:**
```python
# Detect abnormal user behavior
baseline_activity = get_user_baseline("DEFENSE\\logistics.admin")
current_activity = get_user_activity_last_hour("DEFENSE\\logistics.admin")

if current_activity.unique_hosts > baseline_activity.avg_hosts * 3:
    alert("Anomalous user activity - possible lateral movement")
```

---

## ðŸ“Š Correlation Architecture in SIEM

### **Splunk Example: OCSF-Enabled Correlation**

**1. Create OCSF Data Model:**
```xml
<!-- /opt/splunk/etc/apps/ocsf_app/datamodels/OCSF.xml -->
<dataModel>
  <objectModel>
    <objectName>ProcessActivity</objectName>
    <displayName>Process Activity (OCSF 1007)</displayName>
    <parentName>BaseEvent</parentName>
    <fields>
      <field>
        <fieldName>process.pid</fieldName>
        <displayName>Process ID</displayName>
        <type>number</type>
      </field>
      <field>
        <fieldName>process.file.path</fieldName>
        <displayName>Process Path</displayName>
        <type>string</type>
      </field>
      <field>
        <fieldName>process.cmd_line</fieldName>
        <displayName>Command Line</displayName>
        <type>string</type>
      </field>
      <field>
        <fieldName>actor.user.name</fieldName>
        <displayName>User Name</displayName>
        <type>string</type>
      </field>
      <field>
        <fieldName>device.hostname</fieldName>
        <displayName>Hostname</displayName>
        <type>string</type>
      </field>
    </fields>
  </objectModel>
</dataModel>
```

**2. Create Correlation Search:**
```spl
| tstats summariesonly=false count, values(ProcessActivity.process.cmd_line) as commands, values(ProcessActivity.device.hostname) as hosts
  FROM datamodel=OCSF.ProcessActivity
  WHERE
    (ProcessActivity.process.file.name IN ("powershell.exe", "cmd.exe", "psexec.exe"))
    AND (ProcessActivity.process.integrity IN ("High", "System"))
  BY ProcessActivity.actor.user.name, _time span=5m
| where count > 3
| eval alert_description = "Suspicious administrative process activity detected for user: " . 'ProcessActivity.actor.user.name'
```

---

## ðŸš€ Real-World Implementation Steps

### **Phase 1: Proof of Concept (Week 1-2)**

1. Select 3 pilot SOCs (low-risk zones)
2. Use OCSF Playground to generate transformers for:
   - Windows Security Events (4624, 4625, 4688, 4732)
   - Sysmon Events (1, 3, 7, 8, 10, 11, 13, 22, 23)
   - Firewall logs (your specific vendor)
3. Deploy transformers to 1 log pipeline per SOC
4. Ingest OCSF-normalized events into test SIEM index
5. Create 5-10 correlation rules for common attack patterns

### **Phase 2: Validation (Week 3-4)**

1. Run red team exercise in pilot SOCs
2. Measure detection coverage:
   - Attack chain visibility (single SOC)
   - Cross-SOC correlation (IOC hunting)
   - Time to detection (before vs. after OCSF)
3. Tune correlation rules based on false positives

### **Phase 3: Rollout (Month 2-3)**

1. Expand to remaining 27 SOCs
2. Centralize OCSF-normalized events in data lake
3. Build unified SOC analyst dashboard
4. Train analysts on OCSF field schema

### **Phase 4: Advanced Correlation (Month 4+)**

1. Implement machine learning on OCSF data:
   - User behavior analytics (UEBA)
   - Anomaly detection
   - Threat hunting automation
2. Build custom detection rules for nation-state TTPs
3. Integrate with threat intelligence feeds (STIX/TAXII)

---

## ðŸ’¡ Key Takeaways

### **What the Playground Provides:**
âœ… **Transformer code generation** - Convert any log format to OCSF
âœ… **Schema validation** - Ensure OCSF compliance
âœ… **AI-powered field mapping** - No manual work

### **What Your SIEM Provides (After OCSF Normalization):**
âœ… **Event correlation** - Link related events across sources
âœ… **Attack chain detection** - Reconstruct multi-stage attacks
âœ… **Cross-zone hunting** - Find threats across all 30 SOCs
âœ… **Temporal analysis** - Time-based event grouping
âœ… **Entity linking** - Track users/IPs/processes across logs

### **The Value Proposition:**
> **Without OCSF:** 30 isolated SOCs with incompatible logs = blind spots, slow detection, no correlation
>
> **With OCSF:** 30 SOCs speaking the same language = unified visibility, real-time correlation, hunt once - detect everywhere

---

## ðŸŽ¯ Demo Talking Points for Your Client

**Question:** "How does this help with continuous event correlation?"

**Answer:**
> "The playground generates the **transformation code** that normalizes your logs to OCSF. Once deployed to your log pipeline, **every** Sysmon event, Windows event, and firewall log is converted to OCSF format in real-time.
>
> Your SIEM then correlates these standardized events using rules like:
> - 'Show me all systems connecting to this C2 IP'
> - 'Alert when Process Creation + Network Connection + Privilege Escalation happen within 5 minutes'
> - 'Track this user across all 30 SOCs'
>
> **Without OCSF:** You'd need 30 different correlation rules (one per SOC's log format).
> **With OCSF:** One rule works everywhere. Write once, detect everywhere."

Would you like me to create:
1. **Sample SIEM correlation rules** (Splunk, Elastic, QRadar)?
2. **Python correlation engine** (for custom analytics)?
3. **Attack chain visualization** (showing how events link together)?
